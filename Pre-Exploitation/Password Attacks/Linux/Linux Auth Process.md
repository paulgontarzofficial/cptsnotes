- Utilizes various authentication processes, however the most common being the use of the Pluggable Authentication Modules
- The PAM modules are typically located in the following directory: 
	- `/usr/lib/x86_64-linux-gnu/security/`
- Main files that the PAM API reads from is the /etc/passwd and /etc/shadow. 

## Passwd File: 
- Example of a line within the file: n
```shell-session
htb-student:x:1000:1000:,,,:/home/htb-student:/bin/bash
```

A Little Breakdown:

| Field                                              | Value               |
| -------------------------------------------------- | ------------------- |
| Username                                           | `htb-student`       |
| Password                                           | `x`                 |
| User ID                                            | `1000`              |
| Group ID                                           | `1000`              |
| [GECOS](https://en.wikipedia.org/wiki/Gecos_field) | `,,,`               |
| Home directory                                     | `/home/htb-student` |
| Default shell                                      | `/bin/bash`         |
## Shadow File: 
- Similar to the passwd file, however now this file is solely responsible for the password storage and management. 
- The format for this file is split into nine fields:
```shell-session
htb-student:$y$j9T$3QSBB6CbHEu...SNIP...f8Ms:18955:0:99999:7:::
```

|Field|Value|
|---|---|
|Username|`htb-student`|
|Password|`$y$j9T$3QSBB6CbHEu...SNIP...f8Ms`|
|Last change|`18955`|
|Min age|`0`|
|Max age|`99999`|
|Warning period|`7`|
|Inactivity period|`-`|
|Expiration date|`-`|
|Reserved field|`-`|
- If the password field has either the ! or * character, then the user will not be able to login using UNIX Password.

**Password Field Breakdown:**
- If there is an account that does not contain a password within the password field, then we can login with their accounts without providing a password. 
- The password field follows this specific format when storing password hashes:
	`$<id>$<salt>$<hashed>`
- Here is a table for the different Hash ID's that signify which hashing algorithm is being used. 

|ID|Cryptographic Hash Algorithm|
|---|---|
|`1`|[MD5](https://en.wikipedia.org/wiki/MD5)|
|`2a`|[Blowfish](https://en.wikipedia.org/wiki/Blowfish_\(cipher\))|
|`5`|[SHA-256](https://en.wikipedia.org/wiki/SHA-2)|
|`6`|[SHA-512](https://en.wikipedia.org/wiki/SHA-2)|
|`sha1`|[SHA1crypt](https://en.wikipedia.org/wiki/SHA-1)|
|`y`|[Yescrypt](https://github.com/openwall/yescrypt)|
|`gy`|[Gost-yescrypt](https://www.openwall.com/lists/yescrypt/2019/06/30/1)|
|`7`|[Scrypt](https://en.wikipedia.org/wiki/Scrypt)|
- Default nowadays is Yescrypt, however older systems may use other hashing methods. 

## Old Passwords (Opasswd)
- PAM Library can prevent users from reusing old passwords which are typically stored in the following location:
	- /etc/security/opasswd
```shell-session
realCustampin@htb[/htb]$ sudo cat /etc/security/opasswd

cry0l1t3:1000:2:$1$HjFAfYTG$qNDkF0zJ3v8ylCOrKB0kt0,$1$kcUjWZJX$E9uMSmiQeRh4pAAgzuvkq1
```
- Realizing a pattern when it comes to password changes is crucial, we may see a scenario where the opasswd file will give us an easier hashing algorithm to crack, and then we can decrypt those passwords and potentially see a pattern. 


 ```shell-session
realCustampin@htb[/htb]$ sudo cp /etc/passwd /tmp/passwd.bak 
realCustampin@htb[/htb]$ sudo cp /etc/shadow /tmp/shadow.bak 
realCustampin@htb[/htb]$ unshadow /tmp/passwd.bak /tmp/shadow.bak > /tmp/unshadowed.hashes
```

```shell-session
realCustampin@htb[/htb]$ hashcat -m 1800 -a 0 /tmp/unshadowed.hashes rockyou.txt -o /tmp/unshadowed.cracked
```

Download the attached ZIP file (linux-authentication-process.zip), and use single crack mode to find martin's password. What is it?

Use a wordlist attack to find sarah's password. What is it?