- It is important that we know how we can find encrypted files on a machine. With that being said, let us take a look at a script that can output some locations for us: 

```shell-session
realCustampin@htb[/htb]$ for ext in $(echo ".xls .xls* .xltx .od* .doc .doc* .pdf .pot .pot* .pp*");do echo -e "\nFile extension: " $ext; find / -name *$ext 2>/dev/null | grep -v "lib\|fonts\|share\|core" ;done
```


## Hunting for SSH Keys
- Some files do not have an extension, we can still find files that may have a common standard within the file. 
- For example, SSH Private Keys always begin with `-----BEGIN [...SNIP...] PRIVATE KEY-----`. We can use grep to look for files that have that. 
```shell-session
realCustampin@htb[/htb]$ grep -rnE '^\-{5}BEGIN [A-Z0-9]+ PRIVATE KEY\-{5}$' /* 2>/dev/null

/home/jsmith/.ssh/id_ed25519:1:-----BEGIN OPENSSH PRIVATE KEY-----
/home/jsmith/.ssh/SSH.private:1:-----BEGIN RSA PRIVATE KEY-----
/home/jsmith/Documents/id_rsa:1:-----BEGIN OPENSSH PRIVATE KEY-----
<SNIP>
```

Some SSH keys are encrypted with a passphrase. With older PEM formats, it was easy to see whether the SSH key was encrypted or not due to the encryption status on the header. 

One way to check whether there is a passphrase for a key or not is by using ssh-keygen: 
```shell-session
realCustampin@htb[/htb]$ ssh-keygen -yf ~/.ssh/id_rsa

Enter passphrase for "/home/jsmith/.ssh/id_rsa":
```

## Cracking Encrypted SSH Keys
- We can use the locate command to find our John the Ripper applications. 
```shell-session
realCustampin@htb[/htb]$ locate *2john*

/usr/bin/bitlocker2john
/usr/bin/dmg2john
/usr/bin/gpg2john
/usr/bin/hccap2john
/usr/bin/keepass2john
/usr/bin/putty2john
/usr/bin/racf2john
/usr/bin/rar2john
/usr/bin/uaf2john
/usr/bin/vncpcap2john
/usr/bin/wlanhcx2john
/usr/bin/wpapcap2john
/usr/bin/zip2john
/usr/share/john/1password2john.py
/usr/share/john/7z2john.pl
/usr/share/john/DPAPImk2john.py
/usr/share/john/adxcsouf2john.py
/usr/share/john/aem2john.py
/usr/share/john/aix2john.pl
/usr/share/john/aix2john.py
/usr/share/john/andotp2john.py
/usr/share/john/androidbackup2john.py
<SNIP>
```

- We can use ssh2john.py to get the hash, and then use that hash we get and pass it to JtR to crack the passphrase. 

```shell-session
realCustampin@htb[/htb]$ ssh2john.py SSH.private > ssh.hash
realCustampin@htb[/htb]$ john --wordlist=rockyou.txt ssh.hash

Using default input encoding: UTF-8
Loaded 1 password hash (SSH [RSA/DSA/EC/OPENSSH (SSH private keys) 32/64])
Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes
Cost 2 (iteration count) is 1 for all loaded hashes
Will run 2 OpenMP threads
Note: This format may emit false positives, so it will keep trying even after
finding a possible candidate.
Press 'q' or Ctrl-C to abort, almost any other key for status
1234         (SSH.private)
1g 0:00:00:00 DONE (2022-02-08 03:03) 16.66g/s 1747Kp/s 1747Kc/s 1747KC/s Knightsing..Babying
Session completed
```

## Cracking Password-Protected Documents
- Let's say we have a .docx file that is password protected, we can use the office2john.py script to gather the hash and pass it to JtR for cracking. Same can be done with a PDF. 

```shell-session
realCustampin@htb[/htb]$ office2john.py Protected.docx > protected-docx.hash
realCustampin@htb[/htb]$ john --wordlist=rockyou.txt protected-docx.hash
realCustampin@htb[/htb]$ john protected-docx.hash --show

Protected.docx:1234

1 password hash cracked, 0 left
```

```shell-session
realCustampin@htb[/htb]$ pdf2john.py PDF.pdf > pdf.hash
realCustampin@htb[/htb]$ john --wordlist=rockyou.txt pdf.hash
realCustampin@htb[/htb]$ john pdf.hash --show

PDF.pdf:1234

1 password hash cracked, 0 left
```

